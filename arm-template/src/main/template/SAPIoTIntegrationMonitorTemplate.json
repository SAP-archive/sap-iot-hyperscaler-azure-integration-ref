{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "iotHubName": {
            "type": "string",
            "metadata": {
                "description": "Enter Iot Hub resource name."
            }
        },
        "appInsightsName": {
            "type": "string",
            "metadata": {
                "description": "Enter Application Insights connected to all Function Apps in the resource group."
            }
        },
        "eventHubName": {
            "type": "string",
            "metadata": {
                "description": "Enter Event Hub resource name."
            }
        },
        "azureDataExplorerName": {
            "type": "string",
            "metadata": {
                "description": "Enter Azure Data Explorer resource name."
            }
        },
        "redisCacheName": {
            "type": "string",
            "metadata": {
                "description": "Enter Azure Cache for Redis resource name."
            }
        },
        "keyVaultName": {
            "type": "string",
            "metadata": {
                "description": "Enter Key Vault resource name."
            }
        },
        "actionGroupName": {
            "type": "string",
            "metadata": {
                "description": "Enter Action Group name to send notifications or invoke actions when an alert is created."
            }
        }
    },
    "variables": {
        "SAPIoTAzureRefTemplateVersion": "${project.version}",
        "resourceGroupName": "[resourceGroup().name]",
        "dashboardName": "SAP IoT - Azure Integration Dashboard",
        "markdownMetadataType": "Extension/HubsExtension/PartType/MarkdownPart",
        "markdownMetadataContent": "<div style=\"width:100%;border-bottom:1px solid #808080;font-size:24px;padding:8px 0px 2px 20px;font-weight:regular;background:#e4e4e4;color:#000;height:52px\">content</div>",
        "contentIot": "[replace(variables('markdownMetadataContent'),'content', 'IoT Hub')]",
        "contentIngestionFunction": "[replace(variables('markdownMetadataContent'),'content', 'Ingestion Function')]",
        "contentAvroParserFunction": "[replace(variables('markdownMetadataContent'),'content', 'Avro Parser Function')]",
        "contentNotificationProcessorFunction": "[replace(variables('markdownMetadataContent'),'content', 'Notification Processor Function')]",
        "contentDeviceManagementFunction": "[replace(variables('markdownMetadataContent'),'content', 'Device Management Function')]",
        "contentTimeseriesDeleteFunction": "[replace(variables('markdownMetadataContent'),'content', 'Time Series Delete Function')]",
        "contentTimeseriesDeleteMonitoringFunction": "[replace(variables('markdownMetadataContent'),'content', 'Time Series Delete Monitoring Function')]",
        "contentEventHubs": "[replace(variables('markdownMetadataContent'),'content', 'Event Hubs')]",
        "contentAzureDataExplorer": "[replace(variables('markdownMetadataContent'),'content', 'Azure Data Explorer')]",
        "contentRedisCache": "[replace(variables('markdownMetadataContent'),'content', 'Redis Cache')]",
        "contentKeyVault": "[replace(variables('markdownMetadataContent'),'content', 'Key Vault')]",
        "contentAlerts": "[replace(variables('markdownMetadataContent'),'content', 'Metric Alerts')]",
        "metadataChartType": "Extension/HubsExtension/PartType/MonitorChartPart",
        "appInsightsResourceId": "[resourceId(variables('resourceGroupName'), 'Microsoft.Insights/components', parameters('appInsightsName'))]",
        "ADXClusterHealthStatusAlertsName": "ADX Cluster Health Status",
        "ADXResourceId": "[resourceId(variables('resourceGroupName'), 'Microsoft.Kusto/clusters', parameters('azureDataExplorerName'))]",
        "ADXIngestionFailuresAlertsName": "ADX Ingestion Failures",
        "ADXThrottledQueriesAlertsName": "ADX Throttled Queries",
        "deviceManagementFunctionFailuresAlertName": "Device Management Function Failures",
        "eventHubServerErrorsAlertsName": "EventHub Server Errors",
        "eventHubResourceId": "[resourceId(variables('resourceGroupName'), 'Microsoft.EventHub/namespaces', parameters('eventHubName'))]",
        "eventHubThrottlingErrorsAlertsName": "EventHub Throttling Errors",
        "eventHubUserErrorsAlertsName": "EventHub User Errors",
        "iotHubThrottlingErrorsAlertsName": "IoTHub Throttling Errors",
        "iotHubsReourceId": "[resourceId(variables('resourceGroupName'), 'Microsoft.Devices/IotHubs', parameters('iotHubName'))]",
        "redisCacheErrorsAlertsName": "Redis Cache Errors",
        "redisCacheResourceId": "[resourceId(variables('resourceGroupName'), 'Microsoft.Cache/Redis', parameters('redisCacheName'))]",
        "redisCacheServerLoadAlertsName": "Redis Cache Server Load",
        "keyVaultResourceId": "[resourceId(variables('resourceGroupName'), 'Microsoft.KeyVault/vaults', parameters('keyVaultName'))]",
        "vaultAvailabilityAlertsName": "Vault Availability",
        "scheduledQueryRulesNonTransientErrorsAlertName": "Non Transient Errors",
        "deviceManagementFunctionFailuresAlertsName": "Device Management Function Failures",
        "avroParserFunctionFailuresAlertsName": "Avro Parser Function Failures",
        "ingestionFunctionFailuresAlertsName": "Ingestion Function Failures",
        "notificationProcessorFunctionFailuresAlertsName": "Notification Processor Function Failures",
        "deleteTimeSeriesFunctionFailuresAlertsName": "Time Series Delete Function Failures",
        "deleteTimeSeriesMonitoringFunctionFailuresAlertsName": "Time Series Delete Monitoring Function Failures",
        "metricAlertsLocation": "global"
    },
    "resources": [
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('ADXClusterHealthStatusAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "The ADX Cluster health is in poor state.",
                "severity": 0,
                "enabled": true,
                "scopes": [
                    "[variables('ADXResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "adxHealthCriteria",
                            "metricNamespace": "Microsoft.Kusto/clusters",
                            "metricName": "KeepAlive",
                            "dimensions": [],
                            "operator": "LessThan",
                            "timeAggregation": "Average",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Kusto/clusters",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('ADXIngestionFailuresAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Triggered due to a failure in ADX ingestion",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('ADXResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "adxIngestionResultCriteria",
                            "metricNamespace": "Microsoft.Kusto/clusters",
                            "metricName": "IngestionResult",
                            "dimensions": [
                                {
                                    "name": "IngestionResultDetails",
                                    "operator": "Include",
                                    "values": [
                                        "BadFormat"
                                    ]
                                }
                            ],
                            "operator": "GreaterThan",
                            "timeAggregation": "Count",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Kusto/clusters",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('ADXThrottledQueriesAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "The number of ADX queries for configured throughput unit exceeded. No more queries will be accepted.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('ADXResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 5,
                            "name": "adxThrottledQueriesCriteria",
                            "metricNamespace": "Microsoft.Kusto/clusters",
                            "metricName": "TotalNumberOfThrottledQueries",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Kusto/clusters",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('deviceManagementFunctionFailuresAlertName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Failed to process Device Management requests from SAP IoT.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('appInsightsResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "deviceManagementFailureCriteria",
                            "metricNamespace": "Azure.ApplicationInsights",
                            "metricName": "DeviceManagement Failures",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "microsoft.insights/components",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('eventHubServerErrorsAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Error in the Azure Event Hubs service.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('eventHubResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 5,
                            "name": "eventHubServerErrorsCriteria",
                            "metricNamespace": "Microsoft.EventHub/namespaces",
                            "metricName": "ServerErrors",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.EventHub/namespaces",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('eventHubThrottlingErrorsAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Throughput unit usage exceeded the configured value and requests will be throttled.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('eventHubResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 5,
                            "name": "eventHubThrottledRequestsCriteria",
                            "metricNamespace": "Microsoft.EventHub/namespaces",
                            "metricName": "ThrottledRequests",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.EventHub/namespaces",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('eventHubUserErrorsAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Requests not processed due to user errors",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('eventHubResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 5,
                            "name": "eventHubUserErrorsCriteria",
                            "metricNamespace": "Microsoft.EventHub/namespaces",
                            "metricName": "UserErrors",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Count",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.EventHub/namespaces",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('iotHubThrottlingErrorsAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "The number of device-to-cloud messages for configured throughput unit exceeded. New messages will be throttled.",
                "severity": 3,
                "enabled": true,
                "scopes": [
                    "[variables('iotHubsReourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 5,
                            "name": "iotHubThrottlingErrorsCriteria",
                            "metricNamespace": "Microsoft.Devices/IotHubs",
                            "metricName": "d2c.telemetry.ingress.sendThrottle",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Devices/IotHubs",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('redisCacheErrorsAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Errors in Redis Cache",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('redisCacheResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 5,
                            "name": "cacheErrorsCriteria",
                            "metricNamespace": "Microsoft.Cache/Redis",
                            "metricName": "errors",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Cache/Redis",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('redisCacheServerLoadAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "The redis server load is 99% or more.",
                "severity": 2,
                "enabled": true,
                "scopes": [
                    "[variables('redisCacheResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 99,
                            "name": "cacheServerLoadCriteria",
                            "metricNamespace": "Microsoft.Cache/Redis",
                            "metricName": "serverLoad",
                            "dimensions": [],
                            "operator": "GreaterThanOrEqual",
                            "timeAggregation": "Average",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Cache/Redis",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('vaultAvailabilityAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "The total aggregated vault availability is less than 100%.",
                "severity": 0,
                "enabled": true,
                "scopes": [
                    "[variables('keyVaultResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 100,
                            "name": "vaultAvailabilityCriteria",
                            "metricNamespace": "Microsoft.KeyVault/vaults",
                            "metricName": "Availability",
                            "dimensions": [],
                            "operator": "LessThan",
                            "timeAggregation": "Average",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.KeyVault/vaults",
                "targetResourceRegion": "westeurope",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/scheduledqueryrules",
            "apiVersion": "2018-04-16",
            "name": "[variables('scheduledQueryRulesNonTransientErrorsAlertName')]",
            "location": "westeurope",
            "properties": {
                "description": "The Azure function failed during message processing.",
                "enabled": "true",
                "source": {
                    "query": "exceptions\n| project timestamp, problemId, outerMessage, severityLevel, itemType, operation_Name, appName, itemCount\n| where outerMessage like \"\\\"Transient\\\":false\"",
                    "authorizedResources": [],
                    "dataSourceId": "[variables('appInsightsResourceId')]",
                    "queryType": "ResultCount"
                },
                "schedule": {
                    "frequencyInMinutes": 15,
                    "timeWindowInMinutes": 15
                },
                "action": {
                    "severity": "1",
                    "aznsAction": {
                        "actionGroup": [],
                        "customWebhookPayload": "{\"alertname\":\"#alertrulename\", \"IncludeSearchResults\":true}"
                    },
                    "trigger": {
                        "thresholdOperator": "GreaterThan",
                        "threshold": 1
                    },
                    "odata.type": "Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.Microsoft.AppInsights.Nexus.DataContracts.Resources.ScheduledQueryRules.AlertingAction"
                }
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('avroParserFunctionFailuresAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Failed to ingest data using AvroParser function.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('appInsightsResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "avroParserFunctionFailureCriteria",
                            "metricNamespace": "Azure.ApplicationInsights",
                            "metricName": "AvroParser Failures",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Insights/components",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('ingestionFunctionFailuresAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Data Ingestion error - Failed to process message in Mapping function.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('appInsightsResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "ingestionFunctionFailureCriteria",
                            "metricNamespace": "Azure.ApplicationInsights",
                            "metricName": "Ingestion Failures",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Insights/components",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('notificationProcessorFunctionFailuresAlertsName')]",
            "location": "[variables('metricAlertsLocation')]",
            "properties": {
                "description": "Failed to process model change notifications from SAP IoT.",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('appInsightsResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "notificationProcessorFailureCriteria",
                            "metricNamespace": "Azure.ApplicationInsights",
                            "metricName": "NotificationProcessor Failures",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "Microsoft.Insights/components",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('deleteTimeSeriesFunctionFailuresAlertsName')]",
            "location": "global",
            "properties": {
                "description": "Error in deleting time series data",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('appInsightsResourceId')]"
                ],
                "evaluationFrequency": "PT15M",
                "windowSize": "PT15M",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 1,
                            "name": "deleteTimeSeriesFunctionFailureCriteria",
                            "metricNamespace": "Azure.ApplicationInsights",
                            "metricName": "DeleteTimeseries Failures",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "microsoft.insights/components",
                "actions": []
            }
        },
        {
            "type": "microsoft.insights/metricAlerts",
            "apiVersion": "2018-03-01",
            "name": "[variables('deleteTimeSeriesMonitoringFunctionFailuresAlertsName')]",
            "location": "global",
            "properties": {
                "description": "Error in monitoring asynchronous delete time series operation",
                "severity": 1,
                "enabled": true,
                "scopes": [
                    "[variables('appInsightsResourceId')]"
                ],
                "evaluationFrequency": "PT1H",
                "windowSize": "PT1H",
                "criteria": {
                    "allOf": [
                        {
                            "threshold": 0,
                            "name": "deleteTimeSeriesMonitoringFunctionFailureCriteria",
                            "metricNamespace": "Azure.ApplicationInsights",
                            "metricName": "DeleteMonitoringFunction C_PoisonQueueAlert",
                            "dimensions": [],
                            "operator": "GreaterThan",
                            "timeAggregation": "Total",
                            "criterionType": "StaticThresholdCriterion"
                        }
                    ],
                    "odata.type": "Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
                },
                "autoMitigate": true,
                "targetResourceType": "microsoft.insights/components",
                "actions": []
            }
        },
        {
            "type": "Microsoft.Portal/dashboards",
            "apiVersion": "2019-01-01-preview",
            "name": "dashboard",
            "location": "[resourceGroup().location]",
            "tags": {
                "hidden-title": "[variables('dashboardName')]"
            },
            "properties": {
                "lenses": {
                    "0": {
                        "order": 0,
                        "parts": {
                            "0": {
                                "position": {
                                    "x": 0,
                                    "y": 0,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentAlerts')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "1": {
                                "position": {
                                    "x": 0,
                                    "y": 1,
                                    "colSpan": 15,
                                    "rowSpan": 4
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "ComponentId",
                                            "value": "Azure Monitor",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "TimeContext",
                                            "value": null,
                                            "isOptional": true
                                        },
                                        {
                                            "name": "ResourceIds",
                                            "value": [
                                                "Azure Monitor"
                                            ],
                                            "isOptional": true
                                        },
                                        {
                                            "name": "ConfigurationId",
                                            "value": "community-Workbooks/Azure Resources/Alerts",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "Type",
                                            "value": "workbook",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "GalleryResourceType",
                                            "value": "Azure Monitor",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "PinName",
                                            "value": "Alerts",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "StepSettings",
                                            "value": "{\"version\":\"KqlItem/1.0\",\"query\":\"AlertsManagementResources | where type =~ 'microsoft.alertsmanagement/alerts'\\r\\n| where properties.essentials.startDateTime {timeRange}  \\r\\n| extend Severity=tostring(properties.essentials.severity)\\r\\n| where Severity in ({Severity})\\r\\n| extend State=tostring(properties.essentials.alertState)\\r\\n| where \\\"*\\\" in ({State}) or State in ({State})\\r\\n| where \\\"*\\\" in ({ResourceTypes}) or properties.essentials.targetResourceType in~ ({ResourceTypes})\\r\\n| where \\\"*\\\" in ({ResourceGroups}) or properties.essentials.targetResourceGroup in~ ({ResourceGroups})\\r\\n| where \\\"*\\\" in ({Resources}) or properties.essentials.targetResource in~ ({Resources})\\r\\n| project AlertId=id, StartTime=todatetime(tostring(properties.essentials.startDateTime)), Severity, State=tostring(properties.essentials.alertState), Name=name, \\r\\n  TargetResource = tostring(properties.essentials.targetResource), \\r\\n  MonitorService = tostring(properties.essentials.monitorService),\\r\\n  SignalType=tostring(properties.essentials.signalType), Description=tostring(properties.essentials.description)\\r\\n| order by StartTime desc\\r\\n\",\"size\":0,\"title\":\"Alerts\",\"noDataMessage\":\"No alerts found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"AlertId\",\"formatter\":5,\"formatOptions\":{\"linkTarget\":\"Resource\"}},{\"columnMatch\":\"StartTime\",\"formatter\":6},{\"columnMatch\":\"Severity\",\"formatter\":11},{\"columnMatch\":\"State\",\"formatter\":1},{\"columnMatch\":\"Name\",\"formatter\":1,\"formatOptions\":{\"linkTarget\":\"OpenBlade\",\"linkIsContextBlade\":true,\"bladeOpenContext\":{\"bladeName\":\"AlertDetailsTemplateBlade\",\"extensionName\":\"Microsoft_Azure_Monitoring\",\"bladeParameters\":[{\"name\":\"alertId\",\"source\":\"column\",\"value\":\"AlertId\"},{\"name\":\"alertName\",\"source\":\"column\",\"value\":\"Name\"},{\"name\":\"invokedFrom\",\"source\":\"static\",\"value\":\"Workbooks\"}]}},\"tooltipFormat\":{\"tooltip\":\"View alert details\"}},{\"columnMatch\":\"TargetResource\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"subTarget\":\"alerts\",\"showIcon\":true}},{\"columnMatch\":\"essentials\",\"formatter\":5,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true}}",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "ParameterValues",
                                            "value": {
                                                "Subscription": {
                                                    "type": 6,
                                                    "value": [
                                                        "[concat('/subscriptions/', subscription().subscriptionId)]"
                                                    ],
                                                    "formattedValue": "'*'",
                                                    "isPending": false,
                                                    "isWaiting": false,
                                                    "isFailed": false,
                                                    "labelValue": "All",
                                                    "displayName": "Subscriptions",
                                                    "specialValue": [
                                                        "value::all"
                                                    ]
                                                },
                                                "ResourceGroups": {
                                                    "type": 2,
                                                    "value": [
                                                        "[resourceGroup().name]"
                                                    ],
                                                    "formattedValue": "'*'",
                                                    "isPending": false,
                                                    "isWaiting": false,
                                                    "isFailed": false,
                                                    "labelValue": "[resourceGroup().name]",
                                                    "displayName": "Resource groups"
                                                },
                                                "ResourceTypes": {
                                                    "type": 7,
                                                    "value": [
                                                        "*"
                                                    ],
                                                    "formattedValue": "'*'",
                                                    "isPending": false,
                                                    "isWaiting": false,
                                                    "isFailed": false,
                                                    "labelValue": "All",
                                                    "displayName": "Resource types",
                                                    "specialValue": [
                                                        "value::all"
                                                    ]
                                                },
                                                "Resources": {
                                                    "type": 5,
                                                    "value": [
                                                        "*"
                                                    ],
                                                    "formattedValue": "'*'",
                                                    "isPending": false,
                                                    "isWaiting": false,
                                                    "isFailed": false,
                                                    "labelValue": "All",
                                                    "displayName": "Resources",
                                                    "specialValue": [
                                                        "value::all"
                                                    ]
                                                },
                                                "timeRange": {
                                                    "type": 4,
                                                    "value": {
                                                        "durationMs": 86400000,
                                                        "createdTime": "2020-08-04T17:45:51.3Z",
                                                        "isInitialTime": false,
                                                        "grain": 1,
                                                        "useDashboardTimeRange": false
                                                    },
                                                    "formattedValue": "Last 24 hours",
                                                    "isPending": false,
                                                    "isWaiting": false,
                                                    "isFailed": false,
                                                    "labelValue": "Last 24 hours",
                                                    "displayName": "Time Range"
                                                },
                                                "State": {
                                                    "type": 2,
                                                    "value": [
                                                        "*"
                                                    ],
                                                    "formattedValue": "'*'",
                                                    "isPending": false,
                                                    "isWaiting": false,
                                                    "isFailed": false,
                                                    "labelValue": "All",
                                                    "displayName": "State",
                                                    "specialValue": [
                                                        "value::all"
                                                    ]
                                                },
                                                "Severity": {
                                                    "value": [
                                                        "Sev3",
                                                        "Sev2",
                                                        "Sev1",
                                                        "Sev0"
                                                    ],
                                                    "type": 1,
                                                    "formattedValue": "\"Sev3\",\"Sev2\",\"Sev1\",\"Sev0\"",
                                                    "labelValue": "\"Sev3\",\"Sev2\",\"Sev1\",\"Sev0\""
                                                },
                                                "tab": {
                                                    "type": 1,
                                                    "value": "details",
                                                    "formattedValue": "details"
                                                }
                                            },
                                            "isOptional": true
                                        },
                                        {
                                            "name": "Location",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "Extension/AppInsightsExtension/PartType/PinnedNotebookQueryPart"
                                }
                            },
                            "2": {
                                "position": {
                                    "x": 0,
                                    "y": 5,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentIot')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "3": {
                                "position": {
                                    "x": 0,
                                    "y": 6,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('iotHubsReourceId')]"
                                                            },
                                                            "name": "d2c.telemetry.ingress.success",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.devices/iothubs",
                                                            "metricVisualization": {
                                                                "displayName": "Telemetry messages sent",
                                                                "resourceDisplayName": "[parameters('iotHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Rate",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "4": {
                                "position": {
                                    "x": 5,
                                    "y": 6,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('iotHubsReourceId')]"
                                                            },
                                                            "name": "d2c.telemetry.ingress.sendThrottle",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.devices/iothubs",
                                                            "metricVisualization": {
                                                                "displayName": "Number of throttling errors",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('iotHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Throttling Errors",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "5": {
                                "position": {
                                    "x": 10,
                                    "y": 6,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('iotHubsReourceId')]"
                                                            },
                                                            "name": "totalDeviceCount",
                                                            "aggregationType": 3,
                                                            "namespace": "microsoft.devices/iothubs",
                                                            "metricVisualization": {
                                                                "displayName": "Total devices (preview)",
                                                                "resourceDisplayName": "[parameters('iotHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Max Connected Devices",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "6": {
                                "position": {
                                    "x": 0,
                                    "y": 9,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentIngestionFunction')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1,
                                                "markdownUri": ""
                                            }
                                        }
                                    }
                                }
                            },
                            "7": {
                                "position": {
                                    "x": 0,
                                    "y": 10,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "Ingestion C_MessagesProcessed",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion C_MessagesProcessed",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "Ingestion Count",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion Count",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Throughput",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "8": {
                                "position": {
                                    "x": 5,
                                    "y": 10,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "Ingestion AvgDurationMs",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion AvgDurationMs",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Function Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "9": {
                                "position": {
                                    "x": 10,
                                    "y": 10,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "Ingestion Failures",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion Failures",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "Ingestion SuccessRate",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion SuccessRate",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "10": {
                                "position": {
                                    "x": 0,
                                    "y": 13,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentAvroParserFunction')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "11": {
                                "position": {
                                    "x": 0,
                                    "y": 14,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "IncomingMessages",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Incoming Messages",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "AvroParser C_MessagesProcessed",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "AvroParser C_MessagesProcessed",
                                                                "color": "#07c3f7",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "AvroParser Count",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "AvroParser Count",
                                                                "color": "#9ec0f7",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Write Function Throughput",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "12": {
                                "position": {
                                    "x": 5,
                                    "y": 14,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "AvroParser AvgDurationMs",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "AvroParser AvgDurationMs",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Write Function Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "13": {
                                "position": {
                                    "x": 10,
                                    "y": 14,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "AvroParser Failures",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "AvroParser Failures",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "AvroParser SuccessRate",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "AvroParser SuccessRate",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Write Function Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "14": {
                                "position": {
                                    "x": 0,
                                    "y": 17,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentNotificationProcessorFunction')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "15": {
                                "position": {
                                    "x": 0,
                                    "y": 18,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "NotificationProcessor AvgDurationMs",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "NotificationProcessor AvgDurationMs",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Notification Processor Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "16": {
                                "position": {
                                    "x": 5,
                                    "y": 18,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "NotificationProcessor Failures",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "NotificationProcessor Failures",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "NotificationProcessor SuccessRate",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "NotificationProcessor SuccessRate",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Notification Processor Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "17": {
                                "position": {
                                    "x": 0,
                                    "y": 21,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentDeviceManagementFunction')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "18": {
                                "position": {
                                    "x": 0,
                                    "y": 22,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeviceManagement AvgDurationMs",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeviceManagement AvgDurationMs",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Device Management Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "19": {
                                "position": {
                                    "x": 5,
                                    "y": 22,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeviceManagement Failures",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeviceManagement Failures",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeviceManagement SuccessRate",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeviceManagement SuccessRate",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Device Management Function Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "20": {
                                "position": {
                                    "x": 0,
                                    "y": 25,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentTimeseriesDeleteFunction')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "21": {
                                "position": {
                                    "x": 0,
                                    "y": 26,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeleteTimeseries AvgDurationMs",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeleteTimeseries AvgDurationMs",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Time Series Delete Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "22": {
                                "position": {
                                    "x": 5,
                                    "y": 26,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeleteTimeseries Failures",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeleteTimeseries Failures",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeleteTimeseries SuccessRate",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeleteTimeseries SuccessRate",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Time Series Delete Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "23": {
                                "position": {
                                    "x": 0,
                                    "y": 29,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentTimeseriesDeleteMonitoringFunction')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "24": {
                                "position": {
                                    "x": 0,
                                    "y": 30,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeleteMonitoringFunction AvgDurationMs",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeleteMonitoringFunction AvgDurationMs",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Time Series Delete Monitoring Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "25": {
                                "position": {
                                    "x": 5,
                                    "y": 30,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeleteMonitoringFunction Failures",
                                                            "aggregationType": 1,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeleteMonitoringFunction Failures",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('appInsightsResourceId')]"
                                                            },
                                                            "name": "DeleteMonitoringFunction SuccessRate",
                                                            "aggregationType": 4,
                                                            "namespace": "azure.applicationinsights",
                                                            "metricVisualization": {
                                                                "displayName": "DeleteMonitoringFunction SuccessRate",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('appInsightsName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Time Series Delete Monitoring Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "26": {
                                "position": {
                                    "x": 0,
                                    "y": 33,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentEventHubs')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "27": {
                                "position": {
                                    "x": 0,
                                    "y": 34,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "IncomingBytes",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Incoming Bytes.",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "OutgoingBytes",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Outgoing Bytes.",
                                                                "color": "#07c3f7",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Throughput Metrics",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "28": {
                                "position": {
                                    "x": 5,
                                    "y": 34,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "IncomingMessages",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Incoming Messages",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingress Metrics",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "colorMap": {
                                                            "sap.iot.abstract.processed_timeseries_out.v1": "#0078d4",
                                                            "sap.iot.meta.change.v1": "#07c3f7",
                                                            "sap.iot.abstraction.device.management.request": "#9ec0f7",
                                                            "sap.iot.abstraction.device.management.status": "#05a0ab",
                                                            "sap.iot.abstract.adx_timeseries.v1": "#7985ad"
                                                        },
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    },
                                                    "grouping": {
                                                        "dimension": "EntityName",
                                                        "sort": 2,
                                                        "top": 10
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "29": {
                                "position": {
                                    "x": 0,
                                    "y": 37,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "IncomingRequests",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Incoming Requests",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "SuccessfulRequests",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Successful Requests",
                                                                "color": "#02a14c",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "UserErrors",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "User Errors.",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "ThrottledRequests",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Throttled Requests.",
                                                                "color": "#5f00f7",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "ServerErrors",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Server Errors.",
                                                                "color": "#f505cd",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Request Metrics",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "30": {
                                "position": {
                                    "x": 5,
                                    "y": 37,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('eventHubResourceId')]"
                                                            },
                                                            "name": "OutgoingMessages",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.eventhub/namespaces",
                                                            "metricVisualization": {
                                                                "displayName": "Outgoing Messages",
                                                                "resourceDisplayName": "[parameters('eventHubName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Egress Metrics",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "colorMap": {
                                                            "sap.iot.abstract.processed_timeseries_out.v1": "#0078d4",
                                                            "sap.iot.meta.change.v1": "#07c3f7",
                                                            "sap.iot.abstraction.device.management.request": "#9ec0f7",
                                                            "sap.iot.abstract.processed_timeseries_in.v1": "#05a0ab",
                                                            "sap.iot.abstract.adx_timeseries.v1": "#7985ad"
                                                        },
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    },
                                                    "grouping": {
                                                        "dimension": "EntityName",
                                                        "sort": 2,
                                                        "top": 10
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "31": {
                                "position": {
                                    "x": 0,
                                    "y": 40,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentAzureDataExplorer')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "32": {
                                "position": {
                                    "x": 0,
                                    "y": 41,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "KeepAlive",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Keep alive",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Cluster Health",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "filters": {
                                        "MsPortalFx_TimeRange": {
                                            "model": {
                                                "format": "utc",
                                                "granularity": "auto",
                                                "absolute": {
                                                    "fromDate": "2020-06-29T14:23:25.693Z",
                                                    "toDate": "2020-06-29T22:14:42.057Z"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "33": {
                                "position": {
                                    "x": 5,
                                    "y": 41,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "IngestionResult",
                                                            "aggregationType": 7,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion result",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Status",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "colorMap": {
                                                            "Success": "#06b850",
                                                            "DownloadFailed": "#f76300"
                                                        },
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    },
                                                    "grouping": {
                                                        "dimension": "IngestionResultDetails",
                                                        "sort": 2,
                                                        "top": 10
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "34": {
                                "position": {
                                    "x": 10,
                                    "y": 41,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "EventsProcessedForEventHubs",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Events processed (for Event/IoT Hubs)",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Metrics",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "35": {
                                "position": {
                                    "x": 0,
                                    "y": 44,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "IngestionLatencyInSeconds",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion latency (in seconds)",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Ingestion Latency",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "36": {
                                "position": {
                                    "x": 5,
                                    "y": 44,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "QueryDuration",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Query duration",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Query Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "37": {
                                "position": {
                                    "x": 10,
                                    "y": 44,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "TotalNumberOfThrottledQueries",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Total number of throttled queries",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Throttled Queries",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "38": {
                                "position": {
                                    "x": 0,
                                    "y": 47,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "TotalNumberOfThrottledCommands",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Total number of throttled commands",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Throttled Command",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "39": {
                                "position": {
                                    "x": 5,
                                    "y": 47,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "CacheUtilization",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Cache utilization",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "CPU",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "CPU",
                                                                "color": "#07c3f7",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('ADXResourceId')]"
                                                            },
                                                            "name": "IngestionUtilization",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.kusto/clusters",
                                                            "metricVisualization": {
                                                                "displayName": "Ingestion utilization",
                                                                "color": "#9ec0f7",
                                                                "resourceDisplayName": "[parameters('azureDataExplorerName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Cluster Metrics",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "filters": {
                                        "MsPortalFx_TimeRange": {
                                            "model": {
                                                "format": "utc",
                                                "granularity": "auto",
                                                "absolute": {
                                                    "fromDate": "2020-06-29T14:23:25.693Z",
                                                    "toDate": "2020-06-29T22:14:42.057Z"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "40": {
                                "position": {
                                    "x": 0,
                                    "y": 50,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentRedisCache')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "41": {
                                "position": {
                                    "x": 0,
                                    "y": 51,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('redisCacheResourceId')]"
                                                            },
                                                            "name": "cacheLatency",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.cache/redis",
                                                            "metricVisualization": {
                                                                "displayName": "Cache Latency Microseconds (Preview)",
                                                                "resourceDisplayName": "[parameters('redisCacheName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Cache Latency Microseconds",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "42": {
                                "position": {
                                    "x": 5,
                                    "y": 51,
                                    "colSpan": 10,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('redisCacheResourceId')]"
                                                            },
                                                            "name": "cachehits",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.cache/redis",
                                                            "metricVisualization": {
                                                                "displayName": "Cache Hits",
                                                                "color": "#0877cc",
                                                                "resourceDisplayName": "[parameters('redisCacheName')]"
                                                            }
                                                        },
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('redisCacheResourceId')]"
                                                            },
                                                            "name": "cachemisses",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.cache/redis",
                                                            "metricVisualization": {
                                                                "displayName": "Cache Misses",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('redisCacheName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Cache Hits & Misses",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "43": {
                                "position": {
                                    "x": 0,
                                    "y": 54,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('redisCacheResourceId')]"
                                                            },
                                                            "name": "totalkeys",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.cache/redis",
                                                            "metricVisualization": {
                                                                "displayName": "Total Keys",
                                                                "resourceDisplayName": "[parameters('redisCacheName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Key Count",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "44": {
                                "position": {
                                    "x": 5,
                                    "y": 54,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('redisCacheResourceId')]"
                                                            },
                                                            "name": "errors",
                                                            "aggregationType": 1,
                                                            "namespace": "microsoft.cache/redis",
                                                            "metricVisualization": {
                                                                "displayName": "Errors",
                                                                "color": "#f76300",
                                                                "resourceDisplayName": "[parameters('redisCacheName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Cache Errors",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "45": {
                                "position": {
                                    "x": 10,
                                    "y": 54,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('redisCacheResourceId')]"
                                                            },
                                                            "name": "serverLoad",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.cache/redis",
                                                            "metricVisualization": {
                                                                "displayName": "Server Load",
                                                                "resourceDisplayName": "[parameters('redisCacheName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Redis Server Load",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "46": {
                                "position": {
                                    "x": 0,
                                    "y": 57,
                                    "colSpan": 15,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "inputs": [],
                                    "type": "[variables('markdownMetadataType')]",
                                    "settings": {
                                        "content": {
                                            "settings": {
                                                "content": "[variables('contentKeyVault')]",
                                                "title": "",
                                                "subtitle": "",
                                                "markdownSource": 1
                                            }
                                        }
                                    }
                                }
                            },
                            "47": {
                                "position": {
                                    "x": 0,
                                    "y": 58,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('keyVaultResourceId')]"
                                                            },
                                                            "name": "Availability",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.keyvault/vaults",
                                                            "metricVisualization": {
                                                                "displayName": "Overall Vault Availability",
                                                                "resourceDisplayName": "[parameters('keyVaultName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Availability",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "48": {
                                "position": {
                                    "x": 5,
                                    "y": 58,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('keyVaultResourceId')]"
                                                            },
                                                            "name": "ServiceApiLatency",
                                                            "aggregationType": 4,
                                                            "namespace": "microsoft.keyvault/vaults",
                                                            "metricVisualization": {
                                                                "displayName": "Overall Service Api Latency",
                                                                "resourceDisplayName": "[parameters('keyVaultName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "Performance",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "49": {
                                "position": {
                                    "x": 10,
                                    "y": 58,
                                    "colSpan": 5,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "inputs": [
                                        {
                                            "name": "options",
                                            "isOptional": true
                                        },
                                        {
                                            "name": "sharedTimeRange",
                                            "isOptional": true
                                        }
                                    ],
                                    "type": "[variables('metadataChartType')]",
                                    "settings": {
                                        "content": {
                                            "options": {
                                                "chart": {
                                                    "metrics": [
                                                        {
                                                            "resourceMetadata": {
                                                                "id": "[variables('keyVaultResourceId')]"
                                                            },
                                                            "name": "ServiceApiHit",
                                                            "aggregationType": 7,
                                                            "namespace": "microsoft.keyvault/vaults",
                                                            "metricVisualization": {
                                                                "displayName": "Total Service Api Hits",
                                                                "resourceDisplayName": "[parameters('keyVaultName')]"
                                                            }
                                                        }
                                                    ],
                                                    "title": "API Hits",
                                                    "titleKind": 2,
                                                    "visualization": {
                                                        "chartType": 2,
                                                        "legendVisualization": {
                                                            "isVisible": true,
                                                            "position": 2,
                                                            "hideSubtitle": false
                                                        },
                                                        "axisVisualization": {
                                                            "x": {
                                                                "isVisible": true,
                                                                "axisType": 2
                                                            },
                                                            "y": {
                                                                "isVisible": true,
                                                                "axisType": 1
                                                            }
                                                        },
                                                        "disablePinning": true
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "metadata": {
                    "model": {
                        "timeRange": {
                            "value": {
                                "relative": {
                                    "duration": 24,
                                    "timeUnit": 1
                                }
                            },
                            "type": "MsPortalFx.Composition.Configuration.ValueTypes.TimeRange"
                        },
                        "filterLocale": {
                            "value": "en-us"
                        },
                        "filters": {
                            "value": {
                                "MsPortalFx_TimeRange": {
                                    "model": {
                                        "format": "utc",
                                        "granularity": "auto",
                                        "relative": "24h"
                                    },
                                    "displayCache": {
                                        "name": "UTC Time",
                                        "value": "Past 24 hours"
                                    },
                                    "filteredPartIds": []
                                }
                            }
                        }
                    }
                }
            }
        }
    ]
}